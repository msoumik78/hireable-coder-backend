name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on:
  push:
    branches: [ branch-1 ]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 22 from Oracle
      uses: oracle-actions/setup-java@v1
      with:
        website: oracle.com
        release: 22
    - name: Build with Maven
      run: mvn clean package
    - name: Deploy to my EC2 instance
      uses: easingthemes/ssh-deploy@v2.1.5
      env:
        SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        SOURCE: "target/sb-backend-0.0.1-SNAPSHOT.jar"
        REMOTE_HOST: ${{ secrets.SSH_HOST }}
        REMOTE_USER: "ec2-user"
        TARGET: "/home/ec2-user/test-soumik"
    - name: Run the jar
      env:
        PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        HOSTNAME: ${{secrets.SSH_HOST}}
        USER_NAME: ${{secrets.USER_NAME}}

      run: |
        echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
        ssh -o StrictHostKeyChecking=no -i private_key ${USER_NAME}@${HOSTNAME}  'nohup java --enable-preview -jar /home/ec2-user/test-soumik/sb-backend-0.0.1-SNAPSHOT.jar  > nohup.out 2> nohup.err < /dev/null &'
